#!/usr/bin/env python3
"""
grkping - Test connectivity with Grok CLI.
"""
from __future__ import annotations

import os
import sys
import subprocess
import shutil
from pathlib import Path
from typing import Optional


def _find_grok_cli() -> Optional[str]:
    candidates = [
        shutil.which("grok"),
        str(Path.home() / ".npm-global/bin/grok"),
        "/usr/local/bin/grok",
    ]
    for c in candidates:
        if c and Path(c).exists():
            return c
    return None


def main() -> int:
    grok_path = _find_grok_cli()

    if not grok_path:
        print("[ERROR] Grok CLI not found. Install with: npm i -g @vibe-kit/grok-cli")
        return 1

    if not os.environ.get("GROK_API_KEY"):
        print("[ERROR] GROK_API_KEY not set. Get one at https://console.x.ai/")
        return 1

    # Quick version check
    try:
        result = subprocess.run(
            [grok_path, "--version"],
            capture_output=True,
            text=True,
            timeout=5,
        )
        version = result.stdout.strip() or "unknown"
        print(f"âœ… Grok CLI connection OK (v{version})")
        return 0
    except Exception as e:
        print(f"[ERROR] Grok CLI check failed: {e}")
        return 1


if __name__ == "__main__":
    sys.exit(main())
