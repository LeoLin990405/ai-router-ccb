# CCB Gateway Configuration
# Copy to ~/.ccb_config/gateway.yaml to customize

# Server settings
server:
  host: "127.0.0.1"
  port: 8765

# Database settings
database:
  path: null  # Defaults to ~/.ccb_config/gateway.db

# Timeout settings
timeouts:
  default_s: 300.0
  request_ttl_hours: 24

# Queue settings
queue:
  max_size: 1000
  max_concurrent: 10

# Default provider for auto-routing
default_provider: "claude"

# WebSocket settings
websocket:
  enabled: true
  heartbeat_s: 30.0

# Logging
logging:
  level: "INFO"
  file: null  # Defaults to stdout

# Health Check Configuration
health_check:
  enabled: true
  interval_s: 60  # 60秒检查一次（减少频率）
  timeout_s: 15
  failure_threshold: 3
  recovery_threshold: 2

  # Provider-specific health check overrides
  provider_overrides:
    gemini:
      enabled: false  # 禁用 Gemini 健康检查，避免触发登录
      reason: "Requires manual OAuth authentication"

    codex:
      enabled: false  # 禁用 Codex 健康检查
      reason: "Requires manual authentication"

    kimi:
      enabled: true
      timeout_s: 10

    qwen:
      enabled: true
      timeout_s: 10

    deepseek:
      enabled: true
      timeout_s: 45

    opencode:
      enabled: true
      timeout_s: 45

    iflow:
      enabled: true
      timeout_s: 30

# Provider configurations
providers:
  # Claude (Anthropic API)
  claude:
    backend_type: "http_api"
    enabled: true
    priority: 50
    timeout_s: 300.0
    api_base_url: "https://api.anthropic.com/v1"
    api_key_env: "ANTHROPIC_API_KEY"
    model: "claude-sonnet-4-20250514"
    max_tokens: 4096

  # DeepSeek (HTTP API)
  deepseek:
    backend_type: "http_api"
    enabled: true
    priority: 40
    timeout_s: 600.0  # Longer for reasoning
    api_base_url: "https://api.deepseek.com/v1"
    api_key_env: "DEEPSEEK_API_KEY"
    model: "deepseek-reasoner"
    max_tokens: 8192

  # Codex (CLI)
  codex:
    backend_type: "cli_exec"
    enabled: true
    priority: 50
    timeout_s: 300.0
    cli_command: "codex"
    cli_args: ["exec"]
    cli_cwd: "~/.local/share/codex-dual"

  # Gemini (CLI)
  gemini:
    backend_type: "cli_exec"
    enabled: true
    priority: 50
    timeout_s: 600.0
    cli_command: "gemini"
    cli_args: ["-y", "-p"]

  # OpenCode (CLI)
  opencode:
    backend_type: "cli_exec"
    enabled: true
    priority: 40
    timeout_s: 300.0
    cli_command: "opencode"
    cli_args: ["run", "--format", "json", "-m", "opencode/minimax-m2.5-free"]

  # iFlow (CLI)
  iflow:
    backend_type: "cli_exec"
    enabled: true
    priority: 40
    timeout_s: 300.0
    cli_command: "iflow"
    cli_args: ["-p"]

  # Kimi (CLI)
  kimi:
    backend_type: "cli_exec"
    enabled: true
    priority: 40
    timeout_s: 300.0
    cli_command: "kimi"
    cli_args: ["--quiet", "-p"]

  # Qwen (CLI)
  qwen:
    backend_type: "cli_exec"
    enabled: true
    priority: 40
    timeout_s: 300.0
    cli_command: "qwen"
    cli_args: ["-y", "-p", "--auth-type", "qwen-oauth"]

  # Qoder (CLI)
  qoder:
    backend_type: "cli_exec"
    enabled: true
    priority: 45
    timeout_s: 300.0
    cli_command: "qodercli"
    cli_args: ["-p"]
    model: "qoder-default"
    max_tokens: 8192
    supports_streaming: false

  # Droid (Terminal - legacy)
  droid:
    backend_type: "terminal"
    enabled: false  # Disabled by default, requires WezTerm
    priority: 30
    timeout_s: 300.0

# Memory Configuration
memory:
  inject_system_context: false  # 临时禁用以测试
  auto_inject: true
  auto_record: true
